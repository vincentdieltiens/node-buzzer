{"version":3,"sources":["gpio/buzzer.js"],"names":["rpio","GPIOBuzzer","buttons","eventListeners","openPins","call","handlers","event","callback","push","index","indexOf","splice","closePins","controllerIndexes","light","HIGH","LOW","times","duration","i","lightOn","msleep","lightOff","controllerIndex","undefined","buttonIndex","console","log","key","length","value","led","write","forEach","pin","open","OUTPUT","button","INPUT","poll","pressed","read","callHandlers","close"],"mappings":";;;;;;;;;AAAA;;IAAYA,I;;;;;;IAECC,U,CAAW,qB,WAAXA,U;AACZ,qBAAYC,OAAZ,CAAmB,8BAAnB,EAAmD;AAAA;;AAClD,OAAKC,cAAL,GAAsB,EAAE,SAAS,EAAX,EAAe,SAAS,EAAxB,EAAtB;AACA,OAAKD,OAAL,GAAeA,OAAf;AACAE,WAASC,IAAT,CAAc,IAAd;AACA,OAAKC,QAAL,GAAgB,EAAhB;AACA;;;;mCAEgBC,K,EAAOC,Q,CAAQ,c,EAAgB;AAC/C,QAAKL,cAAL,CAAoBI,KAApB,EAA2BE,IAA3B,CAAgCD,QAAhC;AACA,OAAID,SAAS,OAAb,EAAsB;AACrBC;AACA;AACD;;;sCAEmBD,K,CAAK,Y,EAAcC,Q,CAAQ,c,EAAgB;AAC9D,OAAIE,QAAQ,KAAKP,cAAL,CAAoBI,KAApB,EAA2BI,OAA3B,CAAmCH,QAAnC,CAAZ;AACA,QAAKL,cAAL,CAAoBI,KAApB,EAA2BK,MAA3B,CAAkCF,KAAlC,EAAyC,CAAzC;AACA;;;0BAEO;AACPG,aAAUR,IAAV,CAAe,IAAf;AACA;;;0BAEOS,iB,EAAmB;AAC1BC,SAAMV,IAAN,CAAW,IAAX,EAAiBS,iBAAjB,EAAoCd,KAAKgB,IAAzC;AACA;;;2BAEQF,iB,EAAmB;AAC3BC,SAAMV,IAAN,CAAW,IAAX,EAAiBS,iBAAjB,EAAoCd,KAAKiB,GAAzC;AACA;;;wBAEKH,iB,CAAiB,kB,EAAoE;AAAA,OAAhDI,KAAgD,CAA3C,WAA2C,uEAA7B,CAA6B;AAAA,OAA1BC,QAA0B,CAAlB,WAAkB,uEAAJ,GAAI;;AAC1F,QAAI,IAAIC,IAAE,CAAV,EAAaA,IAAIF,KAAjB,EAAwBE,GAAxB,EAA6B;AAC5B,SAAKC,OAAL,CAAaP,iBAAb;AACAd,SAAKsB,MAAL,CAAYH,QAAZ;AACA,SAAKI,QAAL,CAAcT,iBAAd;AACAd,SAAKsB,MAAL,CAAYH,QAAZ;AACA;AACD;;;0BAEOX,Q,CAAQ,c,EAA4F,cAAe;AAAA;;AAAA,OAA3FgB,eAA2F,CAA5E,YAA4E,uEAA7DC,SAA6D;AAAA,OAAlDC,WAAkD,CAAvC,WAAuC,uEAAzBD,SAAyB;;AAC1HE,WAAQC,GAAR,CAAY,YAAZ;AACA,OAAIC,MAAM,KAAV;AACA,OAAIL,mBAAmBC,SAAnB,IAAgCC,eAAeD,SAAnD,EAA8D;AAC7DI,UAAM,EAAN;AACA,QAAIL,mBAAmBC,SAAvB,EAAkC;AACjCI,WAAM,MAAIL,eAAV;AACA;AACD,QAAIE,eAAeD,SAAnB,EAA8B;AAC7BI,YAAO,MAAIH,WAAX;AACA;AACD;;AAED,OAAI,EAAEG,OAAO,KAAKvB,QAAd,CAAJ,EAA6B;AAC5B,SAAKA,QAAL,CAAcuB,GAAd,IAAqB,EAArB;AACA;AACD,QAAKvB,QAAL,CAAcuB,GAAd,EAAmBpB,IAAnB,CAAwBD,QAAxB;AACA,UAAO,YAAM;AACZ,QAAIE,QAAQ,MAAKJ,QAAL,CAAcuB,GAAd,EAAmBlB,OAAnB,CAA2BH,QAA3B,CAAZ;AACA,QAAIE,SAAS,CAAb,EAAgB;AACf,WAAKJ,QAAL,CAAcuB,GAAd,EAAmBjB,MAAnB,CAA0BF,KAA1B,EAAiC,CAAjC;AACA;AACD,IALD;AAMA;;;qCAEiB,WAAY;AAC7B,UAAO,KAAKR,OAAL,CAAa4B,MAApB;AACA;;;;;;AAGF,SAASf,KAAT,CAAeD,iBAAf,EAAkCiB,KAAlC,CAAuC,WAAvC,EAAoD;AACnDJ,SAAQC,GAAR,CAAY,UAAZ,EAAwBd,iBAAxB,EAA2CiB,KAA3C;AACA,KAAI,OAAOjB,iBAAP,IAA6B,QAAjC,EAA2C;AAC1Ca,UAAQC,GAAR,CAAY,QAAZ,EAAsB,KAAK1B,OAAL,CAAaY,iBAAb,EAAgCkB,GAAtD;AACAhC,OAAKiC,KAAL,CAAW,KAAK/B,OAAL,CAAaY,iBAAb,EAAgCkB,GAA3C,EAAgDD,KAAhD;AACA,EAHD,MAGO;AACN,OAAI,IAAIX,IAAE,CAAV,EAAaA,IAAIN,kBAAkBgB,MAAnC,EAA2CV,GAA3C,EAAgD;AAC/CO,WAAQC,GAAR,CAAY,QAAZ,EAAsB,KAAK1B,OAAL,CAAakB,CAAb,EAAgBY,GAAtC;AACAhC,QAAKiC,KAAL,CAAW,KAAK/B,OAAL,CAAakB,CAAb,EAAgBY,GAA3B,EAAgCD,KAAhC;AACA;AACD;AAED;;AAED,SAAS3B,QAAT,GAAoB;AAAA;;AACnBuB,SAAQC,GAAR,CAAY,YAAZ,EAA0B,KAAK1B,OAA/B;AACA,MAAKA,OAAL,CAAagC,OAAb,CAAqB,UAACC,GAAD,CAAI,wBAAJ,EAA8BX,eAA9B,CAA6C,WAA7C,EAA6D;AACjFxB,OAAKoC,IAAL,CAAUD,IAAIH,GAAd,EAAmBhC,KAAKqC,MAAxB,EAAgCrC,KAAKiB,GAArC;AACAjB,OAAKoC,IAAL,CAAUD,IAAIG,MAAd,EAAsBtC,KAAKuC,KAA3B;AACAZ,UAAQC,GAAR,CAAY,cAAZ,EAA4BO,IAAIG,MAAhC;AACAtC,OAAKwC,IAAL,CAAUL,IAAIG,MAAd,EAAsB,YAAM;AAC3B,OAAIG,UAAU,CAACzC,KAAK0C,IAAL,CAAUP,IAAIG,MAAd,CAAf;AACA,OAAIG,OAAJ,EAAa;AACZ,QAAIZ,MAAM,MAAIL,eAAd;AACA,QAAIK,OAAO,OAAKvB,QAAhB,EAA0B;AACzBqC,kBAAa,OAAKrC,QAAL,CAAcuB,GAAd,CAAb,EAAiCL,eAAjC,EAAkD,CAAlD;AACA;AACD,QAAI,SAAS,OAAKlB,QAAlB,EAA4B;AAC3BqC,kBAAa,OAAKrC,QAAL,CAAc,KAAd,CAAb,EAAmCkB,eAAnC,EAAoD,CAApD;AACA;AACD;AACD,GAXD;AAaA,EAjBD;AAkBA;;AAED,SAASX,SAAT,GAAqB;AACpBc,SAAQC,GAAR,CAAY,eAAZ,EAA6B,KAAK1B,OAAlC;AACA,MAAI,IAAIkB,IAAE,CAAV,EAAaA,IAAI,KAAKlB,OAAL,CAAa4B,MAA9B,EAAsCV,GAAtC,EAA2C;AAC1C,MAAIe,MAAM,KAAKjC,OAAL,CAAakB,CAAb,CAAV;AACApB,OAAKwC,IAAL,CAAUL,IAAIG,MAAd,EAAsB,IAAtB;AACA,OAAKf,QAAL,CAAcH,CAAd;AACApB,OAAK4C,KAAL,CAAWT,IAAIH,GAAf;AACAhC,OAAK4C,KAAL,CAAWT,IAAIG,MAAf;AACA;AACDX,SAAQC,GAAR,CAAY,UAAZ;AACA;;AAED,SAASe,YAAT,CAAsBrC,QAAtB,CAA8B,oBAA9B,EAAoDkB,eAApD,CAAmE,WAAnE,EAAgFE,WAAhF,CAA2F,WAA3F,EAAwG;AACvG,KAAI,CAACpB,QAAL,EAAe;AACd;AACA;;AAED,MAAK,IAAIc,CAAT,IAAcd,QAAd,EAAwB;AACvBA,WAASc,CAAT,EAAYI,eAAZ,EAA6BE,WAA7B;AACA;AACD","file":"buzzer.js","sourcesContent":["import * as rpio from 'rpio';\n\nexport class GPIOBuzzer /*implements Buzzer*/ {\n\tconstructor(buttons/*:Array<GPIODomePushButton>*/) {\n\t\tthis.eventListeners = { 'ready': [], 'leave': [] };\n\t\tthis.buttons = buttons;\n\t\topenPins.call(this);\n\t\tthis.handlers = {};\n\t}\n\n\taddEventListener(event, callback/*: Function*/) {\n\t\tthis.eventListeners[event].push(callback);\n\t\tif (event == 'ready') {\n\t\t\tcallback();\n\t\t}\n\t}\n\n\tremoveEventListener(event/*: string*/, callback/*: Function*/) {\n\t\tvar index = this.eventListeners[event].indexOf(callback);\n\t\tthis.eventListeners[event].splice(index, 1);\n\t}\n\n\tleave() {\n\t\tclosePins.call(this);\t\t\n\t}\n\n\tlightOn(controllerIndexes) {\n\t\tlight.call(this, controllerIndexes, rpio.HIGH);\n\t}\n\n\tlightOff(controllerIndexes) {\n\t\tlight.call(this, controllerIndexes, rpio.LOW)\n\t}\n\n\tblink(controllerIndexes/*:Array<number>*/, times/*:number*/ = 5, duration/*:number*/ = 150){\n\t\tfor(var i=0; i < times; i++) {\n\t\t\tthis.lightOn(controllerIndexes);\n\t\t\trpio.msleep(duration);\n\t\t\tthis.lightOff(controllerIndexes);\n\t\t\trpio.msleep(duration);\n\t\t}\n\t}\n\n\tonPress(callback/*: Function*/, controllerIndex/*: number*/ = undefined, buttonIndex/*:number*/ = undefined)/*: Function*/ {\n\t\tconsole.log('onPress : ')\n\t\tvar key = 'all';\n\t\tif (controllerIndex != undefined || buttonIndex != undefined) {\n\t\t\tkey = '';\n\t\t\tif (controllerIndex != undefined) {\n\t\t\t\tkey = 'c'+controllerIndex;\n\t\t\t}\n\t\t\tif (buttonIndex != undefined) {\n\t\t\t\tkey += 'b'+buttonIndex\n\t\t\t}\n\t\t}\n\n\t\tif (!(key in this.handlers)) {\n\t\t\tthis.handlers[key] = [];\n\t\t}\n\t\tthis.handlers[key].push(callback);\n\t\treturn () => {\n\t\t\tvar index = this.handlers[key].indexOf(callback);\n\t\t\tif (index >= 0) {\n\t\t\t\tthis.handlers[key].splice(index, 1);\n\t\t\t}\n\t\t};\n\t}\n\n\tcontrollersCount()/*:number*/ {\n\t\treturn this.buttons.length;\n\t}\n}\n\nfunction light(controllerIndexes, value/*:number*/) {\n\tconsole.log('light : ', controllerIndexes, value)\n\tif (typeof(controllerIndexes) == 'number') {\n\t\tconsole.log('LED : ', this.buttons[controllerIndexes].led)\n\t\trpio.write(this.buttons[controllerIndexes].led, value);\n\t} else {\n\t\tfor(var i=0; i < controllerIndexes.length; i++) {\n\t\t\tconsole.log('LED : ', this.buttons[i].led)\n\t\t\trpio.write(this.buttons[i].led, value);\n\t\t}\n\t}\n\t\n}\n\nfunction openPins() {\n\tconsole.log('buttons : ', this.buttons);\n\tthis.buttons.forEach((pin/*: GPIODomePushButton*/, controllerIndex/*:number*/) => {\n\t\trpio.open(pin.led, rpio.OUTPUT, rpio.LOW);\n\t\trpio.open(pin.button, rpio.INPUT);\n\t\tconsole.log('listening : ', pin.button)\n\t\trpio.poll(pin.button, () => {\n\t\t\tvar pressed = !rpio.read(pin.button);\n\t\t\tif (pressed) {\n\t\t\t\tvar key = 'c'+controllerIndex;\n\t\t\t\tif (key in this.handlers) {\n\t\t\t\t\tcallHandlers(this.handlers[key], controllerIndex, 0);\n\t\t\t\t}\n\t\t\t\tif ('all' in this.handlers) {\n\t\t\t\t\tcallHandlers(this.handlers['all'], controllerIndex, 0);\n\t\t\t\t}\n\t\t\t}\n\t\t});\n\t\t\n\t});\n}\n\nfunction closePins() {\n\tconsole.log('close pins : ', this.buttons);\n\tfor(var i=0; i < this.buttons.length; i++) {\n\t\tvar pin = this.buttons[i];\n\t\trpio.poll(pin.button, null);\n\t\tthis.lightOff(i);\n\t\trpio.close(pin.led);\n\t\trpio.close(pin.button);\n\t}\n\tconsole.log('endclose')\n}\n\nfunction callHandlers(handlers/*:Array<Function>*/, controllerIndex/*:number*/, buttonIndex/*:number*/) {\n\tif (!handlers) {\n\t\treturn;\n\t}\n\n\tfor (var i in handlers) {\n\t\thandlers[i](controllerIndex, buttonIndex);\n\t}\n}"]}